name: Execute Performace Test

on:
  #push:
  #  branches:
  #    - master
  pull_request:
    types: [ closed ]
    branches: [ performance ]

env:
  sendEmail: false
  jmxFilePath: "ops/testDemo.jmx"
  committerEmail: "pavithra.murali@accenture.com"
  committerName: "Pavithra Murali"

jobs:
  action_build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run JMeter Action on a test
        uses: rbhadti94/apache-jmeter-action@v0.5.0
        with:
          testFilePath: ${{ env.jmxFilePath }}
          outputReportsFolder: reports/
          args: "--loglevel INFO"  
      
      - name: Commit Jmeter report to repo
        shell: bash
        run: |
          cd ${{ github.workspace }}/.github/workflows
          sudo chmod +rwx performance.sh
          ./performance.sh
